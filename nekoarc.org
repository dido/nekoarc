NEKOARC ROADMAP
Copyright (C) 2018 Rafael R. Sevilla
----------------------------------------------------------------------
Copying and distribution of this file, with or without modification,
are permitted in any medium without royalty provided the copyright
notice and this notice are preserved.
----------------------------------------------------------------------

* The Arc Runtime
** TODO base virtual machine [7/8]
    - [X] Define virtual machine architecture
    - [X] Design interpreter core
    - [X] Build code generation infrastructure
    - [-] Implement virtual machine instructions [40/43]
      - [X] nop
      - [X] push
      - [X] pop
      - [X] ldl
      - [X] ldi
      - [X] ldg
      - [X] ldlp
      - [X] ldip
      - [ ] ldgp
      - [X] stg
      - [X] lde
      - [X] lde0
      - [ ] ldep
      - [ ] lde0p
      - [X] ste
      - [X] ste0
      - [X] cont
      - [X] env
      - [X] envr
      - [X] apply
      - [X] ret
      - [X] jmp
      - [X] jt
      - [X] jf
      - [X] jbnd
      - [X] true
      - [X] nil
      - [X] no
      - [X] hlt
      - [X] add
      - [X] sub
      - [X] mul
      - [X] div
      - [X] cons
      - [X] car
      - [X] cdr
      - [X] scar
      - [X] scdr
      - [X] is
      - [X] dup
      - [X] cls
      - [X] consr
      - [X] menv
    - [X] Environments [2/2]
      - [X] Stack-based
      - [X] Heap-based

	We use what Clinger et. al. call the stack/heap strategy.
	Environments and continuations normally go on the stack, but
	may be moved to the heap if required, e.g. when a closure or
	continuation is required to outlive its initial context.
	Environments can have their lives extended if one of
	these things happens:

        1. A function returns with a closure in its value register
	2. A closure is stored in the global environment
        3. A closure is stored in an environment other than at level 0.
    - [X] Continuations [2/2]
	  Heap-based continuations are required to support ccc.
      - [X] Stack-based
      - [X] Heap-based
    - [X] Foreign function interface
    - [X] Type invocations [5/5]
      - [X] procedure
      - [X] list
      - [X] vector
      - [X] table
      - [X] string
** TODO Arc reader [0/13]
   - [ ] Lists
   - [ ] Improper lists
   - [ ] Bracketed functions
   - [ ] Quotes
   - [ ] Quasiquotes
   - [ ] Comma expressions
   - [ ] Strings
   - [ ] Runes
   - [ ] Comments
   - [ ] Symbols
   - [ ] Numbers [0/4]
     - [ ] Integer
     - [ ] Flonum
     - [ ] Rational
     - [ ] Complex
   - [ ] Regexps
   - [ ] Atstrings
** TODO Arc compiler [0/5]
   - [ ] Literal expressions [0/9]
     - [ ] nil
     - [ ] true (t)
     - [ ] character
     - [ ] string
     - [ ] fixnum
     - [ ] bignum
     - [ ] flonum
     - [ ] rational
     - [ ] complex
   - [ ] Symbols [0/2]
     - [ ] Environment symbols
     - [ ] Global symbols
   - [ ] Lists [0/3]
     - [ ] Special forms [0/8]
       - [ ] if
       - [ ] fn [0/5]
	 - [ ] single symbol arguments
	 - [ ] simple argument lists
	 - [ ] optional arguments
         - [ ] rest arguments
	 - [ ] destructuring binds
       - [ ] quote
       - [ ] quasiquote
       - [ ] assign
       - [ ] compose in a functional position
       - [ ] complement in a functional position
       - [ ] andf in a functional position
     - [ ] Inline functions [0/7]
       - [ ] cons
       - [ ] car
       - [ ] cdr
       - [ ] +
       - [ ] -
       - [ ] *
       - [ ] /
     - [ ] Function applications
   - [ ] Macros
   - [ ] Special Syntax [0/4]
     - [ ] Compose (:)
     - [ ] Complement (~)
     - [ ] Structure access (. and !)
     - [ ] And (&)
** TODO basic data types [14/18]
    - [X] Nil
    - [X] True
    - [X] Numeric Types [2/2]
      - [X] fixnum
      - [X] flonum
    - [X] Runes
    - [X] Strings
    - [X] Symbols
    - [X] Conses
    - [X] Tables
    - [X] Vectors
    - [X] Tagged
    - [X] Functions
    - [-] Input Ports [1/2]
      - [X] instring
      - [ ] infile
    - [-] Output Ports [1/2]
      - [X] outstring
      - [ ] outfile
    - [X] Threads
    - [ ] Exceptions
    - [X] Channels
    - [X] Closures (code)
    - [ ] Objects
** TODO Runtime Built-In Functions [6/19]
   Consider whether or not to provide instructions for the asterisked
   functions, so as to make their use cheaper.
   - [X] Initialization for binding runtime primitives to global symbols
   - [X] Type handling [5/5]
     - [X] coerce [8/8]
       - [X] Fixnum conversions [4/4]
	 - [X] fixnum (trivial)
         - [X] flonum
         - [X] string
         - [X] rune
       - [X] Flonum conversions [3/3]
	 - [X] flonum (trivial)
	 - [X] fixnum
	 - [X] string
       - [X] Rune conversions [3/3]
         - [X] rune (trivial)
	 - [X] fixnum
	 - [X] string
       - [X] String conversions [6/6]
         - [X] string (trivial)
	 - [X] fixnum (only if string is an integer)
         - [X] flonum (only if string can be parsed to a flonum)
	 - [X] symbol (same as intern)
	 - [X] cons (converted into a list of characters)
         - [X] vector (converted into a vector of characters)
       - [X] Symbol conversions [2/2]
         - [X] symbol -> symbol (trivial)
         - [X] string
       - [X] Cons conversions [3/3]
         - [X] cons (trivial)
	 - [X] string
         - [X] vector
       - [X] Table conversions [2/2]
         - [X] table (trivial)
         - [X] string
       - [X] Vector conversions [3/3]
         - [X] vector (trivial)
	 - [X] cons
         - [X] string
     - [X] type
     - [X] annotate
     - [X] rep
     - [X] sym
   - [X] Predicates [8/8]
     - [X] Less-than (<) *
     - [X] Greater-than (>) *
     - [X] Less-than or equal (<=) *
     - [X] Greater-than or equal (>=) *
     - [X] spaceship operator (<=>) * (Arcueid extension)
     - [X] exact
     - [X] is
     - [X] iso
   - [X] List operations [7/7]
     - [X] car
     - [X] cdr
     - [X] cadr
     - [X] cddr
     - [X] cons
     - [X] scar
     - [X] scdr
   - [-] Math operations [0/4]
     - [-] Arithmetic [1/5]
       - [ ] * Multiplication
       - [X] + Addition
       - [ ] - Subtraction
       - [ ] / Division
       - [ ] div - integer division (extension)
     - [ ] Complex arithmetic [0/4]
	   This is again an Arcueid extension.  It's rather annoying
	   to have support for complex numbers but no functions to
	   manipulate them.
       - [ ] real
       - [ ] imag
       - [ ] conj
       - [ ] arg -- complex argument
     - [ ] Arc3-current functions [0/6]
       - [ ] expt
       - [ ] mod
       - [ ] rand
       - [ ] srand
       - [ ] sqrt
       - [ ] trunc
     - [ ] C99 math.h functions (Arcueid only) [0/37]
	   These functions should support complex arguments in as far
	   as it makes sense to do so.
       - [ ] abs -- works for all numeric types
       - [ ] acos
       - [ ] acosh
       - [ ] asin
       - [ ] asinh
       - [ ] atan
       - [ ] atan2
       - [ ] atanh
       - [ ] cbrt
       - [ ] ceil
       - [ ] cos
       - [ ] cosh
       - [ ] erf
       - [ ] erfc
       - [ ] exp
       - [ ] expm1
       - [ ] floor
       - [ ] fmod
       - [ ] frexp
       - [ ] hypot
       - [ ] ldexp
       - [ ] lgamma
       - [ ] log
       - [ ] log10
       - [ ] log2
       - [ ] logb
       - [ ] modf
       - [ ] nan
       - [ ] nearbyint
       - [ ] pow (alias for expt)
       - [ ] sin
       - [ ] sinh
       - [ ] sqrt (also in arc3)
       - [ ] tan
       - [ ] tanh
       - [ ] tgamma
       - [ ] trunc (also in arc3)
   - [X] Table operations [2/2]
     - [X] maptable
     - [X] table
   - [ ] Evaluation [0/4]
     - [ ] eval
     - [ ] apply
     - [ ] ssexpand
     - [ ] ssyntax
   - [ ] Macros [0/4]
     - [ ] macex
     - [ ] macex1
     - [ ] sig
	   This is actually a global variable, and needs to be
	   assigned at initialization.	   
     - [ ] uniq
   - [-] Basic I/O primitives [3/5]
         These are the base I/O functions provided by the Arcueid C
         runtime.
     - [X] Input [4/4]
       - [X] readb
       - [X] readc
       - [X] peekc
	     Implemented in terms of ungetc
       - [X] ungetc - this is not part of standard Arc
	   Note that there is no ungetb function.  This is proving a
	   little tricky to implement.  Maybe what we should do is
	   simplify the semantics of ungetc so that it requires a
	   character to be unget'd, and the next call to readc OR
	   readb (yes, readb with a 'b'!) will return this
	   CHARACTER.  This saves us the trouble of decoding UTF-8
	   all over again, and reinforces the maxim of never mixing
	   the b functions with the c functions.
     - [X] Output [2/2]
       - [X] writeb
       - [X] writec
     - [ ] File I/O [0/3]
       - [ ] infile
       - [ ] outfile
       - [ ] close
     - [X] String port I/O [3/3]
	   Note that doing readb/writeb or readc/writec on a string
	   port have the same effect.  Strings are made up of Unicode
	   characters so it would be quite messy to implement a
	   separate 'byte index' into what is made up of characters.
       - [X] instring
       - [X] outstring
       - [X] inside
     - [ ] Seeking / telling [0/2]
             Note that these essential functions are not available in
             PG-Arc for some reason but will probably be necessary to
             implement CIEL.
       - [ ] seek
       - [ ] tell
   - [ ] Additional I/O functions (src/io.c) [0/8]
         These other I/O functions are defined in standard Arc but are not
         necessary for CIEL or the reader, so we do them later.
     - [ ] pipe-from
     - [ ] stdin
     - [ ] stdout
     - [ ] stderr
     - [ ] call-w/stdin
     - [ ] call-w/stdout
     - [ ] disp
     - [ ] flushout
   - [ ] Threads [0/2]
     - [ ] Creating and managing threads [0/8]
       - [ ] new-thread (spawn)
       - [ ] break-thread
       - [ ] kill-thread
       - [ ] current-thread
       - [ ] dead
       - [ ] sleep
       - [ ] atomic-invoke - implemented using channels
       - [ ] join-thread (not in standard Arc)
     - [ ] Channels (cf. Limbo and CSP, Arcueid extension) [0/3]
       - [ ] chan
       - [ ] <- (recv-channel) *
       - [ ] <-= (send-channel) *
   - [ ] File system operations [0/5]
     - [ ] dir
     - [ ] dir-exists
     - [ ] file-exists
     - [ ] rmfile
     - [ ] mvfile
   - [-] Error handling and continuations [2/8]
     - [ ] details
     - [ ] err
     - [ ] on-err
     - [X] ccc
     - [ ] protect
     - [X] dynamic-wind
     - [ ] ccmark
     - [ ] scmark
   - [X] Strings [1/1]
     - [X] newstring
   - [ ] Objects [0/3]
     - [ ] obj
     - [ ] clone
     - [ ] slot
   - [ ] Time [0/5]
     - [ ] current-gc-milliseconds
     - [ ] current-process-milliseconds
     - [ ] msec
     - [ ] seconds
     - [ ] timedate
   - [ ] Regular Expressions (Arcueid extension) [0/3]
     - [ ] regular expression input in the reader
     - [ ] regular expression matching [0/2]
       - [ ] Basic matching
       - [ ] Substring captures
     - [ ] regcomp (compile a regular expression from a string)
   - [ ] Miscellaneous OS operations [0/4]
     - [ ] system
     - [ ] quit
     - [ ] setuid
     - [ ] memory
   - [-] Miscellaneous [3/5]
     - [X] sref *
     - [X] len
     - [X] bound
     - [ ] arcueid-code-setname
     - [ ] declare
** TODO Threading [0/6]
   - [ ] Basic scheduling
   - [ ] Suspend threads on I/O
   - [ ] Synchronization
   - [ ] Deadlock detection
   - [ ] Thread control
   - [ ] alt mechanism
** TODO Baseline environment (arc.arc) [0/2]
   - [ ] Load all arc.arc functions
   - [ ] Test behaviour of all arc.arc functions
** TODO pretty printer [0/2]
   - [ ] Framework for disp and write
   - [ ] Printers for various types [0/17]
     - [ ] nil
     - [ ] t
     - [ ] Numeric Types [0/5]
       - [ ] Fixnums
       - [ ] Bignums
       - [ ] Rationals
       - [ ] Flonums
       - [ ] Complex numbers
     - [ ] Runes
     - [ ] Strings
     - [ ] Symbols
     - [ ] Conses
     - [ ] Tables
     - [ ] Vectors
     - [ ] Tagged
     - [ ] Functions
     - [ ] Input Ports
     - [ ] Output Ports
     - [ ] Threads
     - [ ] Exceptions
     - [ ] Channels
     - [ ] Regular Expressions
** TODO REPL [0/3]
   - [ ] Simple non-readline REPL
   - [ ] Read in an initial file for REPL
   - [ ] Readline support
** TODO Regular Expressions [0/3]
   We don't plan to provide complete compatibility with Perl or POSIX.
   Just enough.
   - [ ] Basic regular expression interface
   - [ ] Macro wrapping for matches
   - [ ] Features [0/12]
     - [ ] Characters
     - [ ] Escaped characters
     - [ ] Character classes [0/3]
       - [ ] Basic (e.g. [A-Z])
       - [ ] Perl-style character classes (\d, \s, etc.)
       - [ ] Unicode property character classes
     - [ ] Anchors [0/7]
       - [ ] ^ (beginning of line)
       - [ ] $ (end of line)
       - [ ] \A (start of string)
       - [ ] \Z (end of string)
       - [ ] \z (absolute end)
       - [ ] \b (beginning of word)
       - [ ] \B (end of word)
     - [ ] Kleene star
     - [ ] Kleene plus
     - [ ] Counted repetition
     - [ ] Alternation
     - [ ] Capture groups
     - [ ] Non-capturing groups
     - [ ] Case-insensitive matching
     - [ ] Multi-line regexes
** TODO Formatted output
   In addition to Arc standard prf, there will also be a printf
   function which can be used to output strings according to a format
   string specified.  The usual conversion specifiers for standard C
   printf are available, with some additional non-standard ones:
   - r or m : no argument required - print the output of
     strerror(errno).
   - v : replace by the pretty-printed form of the argument.

   This is also the same format specification used by the error
   handler function signal_error.

* Enhancements
** TODO Format strings
   We will provide for format strings similar to C, but with a few
   extensions that make sense for Arc.
** TODO Character/string comparisons/translations
   Character/string comparisons, by default use the Unicode Collation
   algorithm (http://www.unicode.org/reports/tr10/)?  Capitalization
   and decapitalization should also be locale-defined. An
   implementation of the algorithms for doing these things appears to
   be ICU4C (http://site.icu-project.org).  See if we can adapt the
   code or use it as a library.
